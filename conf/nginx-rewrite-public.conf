# ---------------------------------------------------
# my_webapp__3 rewrite.conf pour Yunohost - subpath
# ---------------------------------------------------

# Exception pour ads.txt : sert le fichier directement
location = __PATH__/ads.txt {
    alias __INSTALL_DIR__/www/public/ads.txt;
    add_header Content-Type text/plain;
    access_log off;
    log_not_found off;
}

# Redirection globale type front controller
location __PATH__/ {
    root __INSTALL_DIR__/www/public;
    index index.php index.html;

    # Catch-all pour PHP front controller
    try_files $uri $uri/ /index.php?$query_string;
    autoindex off;

    # Interdire certains fichiers sensibles
    location ~* \.(json|tpl|ini|env)$ {
        deny all;
    }

    # Interdire l'accès aux fichiers et dossiers cachés, sauf .well-known
    location ~ ^__PATH__/(.+/|)\.(?!well-known/) {
        deny all;
    }

    # Fichiers spécifiques
    location = __PATH__/favicon.ico {
        log_not_found off;
        access_log off;
    }

    location = __PATH__/robots.txt {
        allow all;
        log_not_found off;
        access_log off;
    }

    # Inclure les configs spécifiques de l'application
    include conf.d/__DOMAIN__.d/__APP__.d/*.conf;

    # Inclure le panel Yunohost
    include conf.d/yunohost_panel.conf.inc;
}
