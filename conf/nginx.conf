#sub_path_only rewrite ^__PATH__$ __PATH__/ permanent;
location __PATH__/ {

    # Path to source
    alias __INSTALL_DIR__/www/;

    # Default indexes and catch-all
    index index.php index.html;
    try_files $uri $uri/ __PATH__/index.php?$args =404;

    # Prevent useless logs
    location = __PATH__/favicon.ico {
        log_not_found off;
        access_log off;
    }

    location = __PATH__/robots.txt {
        allow all;
        log_not_found off;
        access_log off;
    }

    # Deny access to hidden files and directories
    location ~ ^__PATH__/(.+/|)\.(?!well-known\/) {
        deny all;
    }

    # Execute and serve PHP files
    location ~ [^/]\.php(/|$) {
        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
        fastcgi_pass unix:/var/run/php/php__PHP_VERSION__-fpm-__APP__.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param REMOTE_USER $remote_user;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $request_filename;
    }

    {% if custom_error_file -%}
    # Custom error pages
    error_page 403 __PATH__/error/403.html;
    error_page 404 __PATH__/error/404.html;

    location ^~ __PATH__/error/ {
        internal;
    }
    {%- endif %}
    
    # FIXME : this should be settable using a setting which should also match the PHP stuff (and actually relevant for no-PHP scenario for other apps)
    client_max_body_size 50M;

    #
    # Insert here possibly custom tweaks
    #


    #
    # End custom tweaks
    # 
}
