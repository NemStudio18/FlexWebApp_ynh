# rewrite-framework.conf
# Mode framework - rewrite vers /public/index.php

# Exception pour ads.txt si présent dans public
location = __PATH__/public/ads.txt {
    alias __INSTALL_DIR__/www/public/ads.txt;
    add_header Content-Type text/plain;
    access_log off;
    log_not_found off;
}

# Points d'entrée pour /public/ - rewrite vers public/index.php
location __PATH__/ {
    root __INSTALL_DIR__/www;
    try_files $uri $uri/ /__PATH__/public/index.php?$query_string;
    autoindex off;
}

# Si besoin d'interdire certains fichiers dans /public
location ~* ^__PATH__/public/.*\.(json|tpl|ini|env)$ {
    deny all;
}

# Interdire l'accès aux fichiers et dossiers cachés, sauf .well-known
location ~ ^__PATH__/(.+/|)\.(?!well-known/) {
    deny all;
}

# Bloquer l'accès au fichier de mot de passe SFTP
location = /sftp_password.txt {
    deny all;
    return 403;
}
