# Configuration Nginx suppl√©mentaire pour mode CMS avec front controller
# Ce fichier s'ajoute √† la configuration principale nginx.conf
# Version pour CMS avec index.php dans le dossier /public (Laravel, Symfony, etc.)

# Exception pour ads.txt : sert le fichier directement
location = __PATH__/ads.txt {
    # alias pointe DIRECTEMENT sur le fichier physique
    alias __INSTALL_DIR__/www/public/ads.txt;

    # type MIME
    add_header Content-Type text/plain;
    # logs superflus d√©sactiv√©s
    access_log  off;
    log_not_found off;
}

# Redirection globale type front controller (remplace le try_files par d√©faut)
# Point vers le dossier /public o√π se trouve index.php
location __PATH__/ {
    root __INSTALL_DIR__/www/public;
    try_files $uri /index.php$is_args$args;
    autoindex off;
}

# Interdire certains fichiers sensibles
location ~* __PATH__/.*\.(json|tpl|ini|env)$ {
    deny all;
}

# Interdire l'acc√®s aux fichiers et dossiers cach√©s, sauf .well-known
location ~ ^__PATH__/(.+/|)\.(?!well-known/) {
    deny all;
}

# Interpr√©tation des fichiers PHP (remplace la configuration par d√©faut)
location ~ __PATH__/.*\.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/run/php/php__PHPVERSION__-fpm.sock;

    # üëá Ce param√®tre est CRUCIAL pour PHP-FPM
    fastcgi_param SCRIPT_FILENAME $request_filename;
} 